import { cors } from '@elysiajs/cors'
import { withHttpLogger } from '@covenote/elysia-logger'
import { createLogger } from '@covenote/logger'
import { {{ camelCase name }}EnvConfig } from '@covenote/{{ name }}-config'
import { Elysia } from 'elysia'
import { chatRoutes } from './routes/chat'
import { healthRoutes } from './routes/health'

const logger = createLogger('{{ name }}')

const app = withHttpLogger(new Elysia())
  .use(cors({ origin: {{ camelCase name }}EnvConfig.app.cors }))
  .use(healthRoutes)
  .use(chatRoutes)
  .listen({{ camelCase name }}EnvConfig.app.port)

logger.info(`Server running at ${app.server?.hostname}:${app.server?.port}`)

export type App = typeof app
